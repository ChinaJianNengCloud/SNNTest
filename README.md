## 使用

- 训练:`python train.py 训练数据集文件夹路径 测试数据集文件夹路径`
  - 增加`--batch_size 1000 --group_size 10`可以合并数据，减少矩阵的稀疏性
- 预测某个文件（待完善，先参考predict.ipynb）：`python predict.py 模型权重路径 需要预测的文件`

## 原理

### 脉冲神经元和脉冲神经网络

- 先理解LSTM，时间需序列的预测有助于理解脉冲神经元，但是实际上二者差别很大，只是看起来像，不要过分纠结。
- 基本原理参考：[spikingjelly 框架对神经元的解释](https://spikingjelly.readthedocs.io/zh-cn/latest/activation_based/neuron.html)
- 个人认为脉冲神经元代替了ANN中激活参数的作用

### 指标的计算

- 在做这个项目的时候，指标方面的处理遇到了许多情况，需要进行特殊说明
- 首先是对于混淆矩阵的计算
  - 假设现在有10个值，6个预测正确
  - 考虑分组的情况，什么情况下分组后整体的指标计算和分组平均后的结果不一样？
    - 分组数量不一致， 如4个的一组中，3个预测正确，6个分组中，3个预测正确，则分组平均后的acc为(0.75+0.5)/2
    - 而整体不分组的情况下，acc为0.6
  - 什么情况下一样
    - 分组后每组的数量一致，具体见下面示例代码，发现两个组的混淆矩阵对应相加后正好等于整体
    - 注意！！！还有一种情况，就是当你的指标计算时，分母是0的时候
      - 比如对于precision或者recall指标，只用到fp, fn, tp
      - 但是见下面示例代码，在原始数据全为0时，fn, tp为0，影响recall；预测数据全为0时，fp, fn为0，则影响precision；而分母为0时，无法计算指标
      - 同样还可以发现，去掉这组数据，不影响整体的指标计算，这也是项目代码中使用的方法
- 对于模型指标的评价
  - 基于以上混淆矩阵计算原理可以发现，我们评价模型指标的时候并不需要对文件进行分组计算
    - 原本我认为应该一个文件计算一次指标再平均
    - 实际上在数学上，二者是等价的
    - 还有一个很重要的原因是，自己写循环代码是不如调用接口的numpy操作更快的
  - 但是我们可能需要对通道进行分组计算
    - 基于现实的情况，我们除了想看模型的预测效果，还可能想看芯片通道的预测效果
    - 这有助于观察哪个通道是有效的（当然这涉及到原本实验的设计是不是应该考虑通道的有效性）
    - 同样的，项目代码中使用了上诉等数量分组指标平均后与整体直接计算等价的原理，直接对T和N两个维度进行计算
    - 但是多做了一步操作，因为发现竟然有通道数千个文件加起来全是0的情况，这也是为什么上述混淆矩阵计算的时候提到了分母为0可以直接去掉这组的原因
  - 当然由于本项目数据的稀疏性，可能会产生其他奇怪的情况，所以应该先对数据进行分析，看看哪里是全0的情况，再进行操作
```python
from sklearn.metrics import confusion_matrix

raw1 = [0, 1, 0, 0]
raw2 = [1, 0, 1, 0]
raw3 = [0, 0, 0, 0]
raw4 = [0, 0, 1, 0]
predict1 = [0, 0, 1, 0]
predict2 = [1, 1, 0, 0]
predict3 = [0, 0, 0, 1]
predict4 = [0, 0, 0, 0]
print('raw1:')
print(confusion_matrix(raw1, predict1))
print('raw2:')
print(confusion_matrix(raw2, predict2))
print('group1:')
print(confusion_matrix(raw1 + raw2, predict1 + predict2))
print('group2:')
print(confusion_matrix(raw1 + raw3, predict1 + predict3))
print('group3:')
print(confusion_matrix(raw1 + raw4, predict1 + predict4))
# 结果：
# raw1:
# [[2 1]
#  [1 0]]
# raw2:
# [[1 1]
#  [1 1]]
# group1:
# [[3 2]
#  [2 1]]
# group2:
# [[5 2]
#  [1 0]]
# group3:
# [[5 1]
#  [2 0]]
```

## 待解决的问题

- 如何实现变长序列的预测
- 损失函数的选择
- 如何科学的组建网络和设置loss的权重，以是由于类脑器官电信号的预测